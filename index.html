<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Мы хотим, чтобы вы были пер...</title>

<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=2.0">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<style>
html {
    position: relative;
    min-height: 100%;
}

/*
 * SlotMachine
 */
#randomize {
	// padding-top:100px;
    height: 400px;
}

#randomize .row > div.col-xs-4 {
    padding-left: 35px;
}

#randomize .row > div.col-lg-4 {
    padding-left: 45px;
    padding-right: 25px;
}

#randomize .row > div.col-xs-4 > div {
    width: 320px;
    height: 320px;
    background-color: #fff;
    border-radius: 50%;
    margin: auto;
}

.randomizeMachine {
    width: 320px;
    height: 320px;
}

.btn-group-randomize {
    margin: 0 auto;
    margin-top: 30px;
    width: auto;
}

.btn-group-randomize div {
    width: auto !important;
}

.jumbotron {
    text-align: center;
    background-color: transparent;
    padding-bottom: 0;
    padding-top: 18px;
}
.jumbotron h1 {
    font-weight: normal
}

#greetingText {
    padding-top: 5px;
}
#greetingText img {
    max-width:100%;
}
</style>


<link rel="stylesheet" href="dist/jquery.slotmachine.css" type="text/css" media="screen" />

<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<script async src="http://c-cdn.coub.com/embed-runner.js"></script>
<script type="text/javascript" src="dist/jquery.slotmachine.js"></script>
<script src="data.js"></script>

</head>

<body>
<div id="randomize">
	<div class="content container">
        <div class="jumbotron">
            <h1>Загадка на 8 марта</h1>

            <p>Каждый мальчик МИФа вставил в&nbsp;квадратик картинку.
                Мы разбавили свои картинки случайными.
                Нажмите на&nbsp;кнопку и&nbsp;угадайте кто какую картинку вставил.
                Ответ присылайте в&nbsp;письмо с&nbsp;поздравлением.
            </p>
        </div>

        <div style="padding-bottom: 20px">
            <div class="btn-group btn-group-justified btn-group-randomize" role="group">
                <div id="ranomizeButton" type="button" class="btn btn-danger btn-lg">Мне повезет!</div>
            </div>
        </div>

		<div class="row">
			<div class="col-xs-4">
				<div>
					<div id="machine1" class="randomizeMachine">
					</div>
				</div>
			</div>

			<div class="col-xs-4">
				<div>
					<div id="machine2" class="randomizeMachine">
					</div>
				</div>
			</div>

			<div class="col-xs-4">
				<div>
					<div id="machine3" class="randomizeMachine">
					</div>
				</div>
			</div>
		</div>

        <div id="greetingText" class="row">
            <div class="col-lg-4"><p class="js-txt-1"></p></div>

            <div class="col-lg-4"><p class="js-txt-2"></p></div>

            <div class="col-lg-4"><p class="js-txt-3"></p></div>
        </div>
	</div>
</div>


<script>
$(document).ready(function(){

	$('#randomize').css({opacity: 0});

	var attempts = 0;

	//тут список картинок
	var presents = [
        {
            img: 'img/igor.jpg',
            text: 'Выпьем за любовь!',
            is_rand: true
        },
        {
		    img: 'img/iphone.jpg',
            text: 'iPhone и так уже у всех есть, поэтому это самый бессмысленный подарок на 8 марта',
            is_rand: true
        },
        {
            img: 'img/fur.jpg',
            text: 'Шубу- шубу- шубу ем,<br>'
                + 'Шубу ем, не спеша<br>'
                + 'Шуба- шуба- шуба всем<br>'
                + 'Шуба всем хороша!',
            is_rand: true
        },
        {
            img: 'http://thecatapi.com/api/images/get?format=src&type=gif&size=med&1',
            text: '— Вот иду я красивая по улице, а мужики вокруг так и падают, так и падают… И сами в штабеля укладываются!',
            is_rand: true
        },
        {
            img: 'http://thecatapi.com/api/images/get?format=src&type=gif&size=med&2',
            text: 'У меня же по щам всегда пятёрки были…',
            is_rand: true
        },
        {
            img: 'http://thecatapi.com/api/images/get?format=src&type=gif&size=med&3',
            text: 'Комсомолка, спортсменка и просто красавица!',
            is_rand: true
        },
        {
            img: 'http://thecatapi.com/api/images/get?format=src&type=gif&size=med&4',
            text: 'Чтобы генеральшей стать, надо за лейтенанта замуж выходить.',
            is_rand: true
        },
        {
            img: 'http://thecatapi.com/api/images/get?format=src&type=gif&size=med&5',
            text: 'Если женщина нравится мужчине, разве важны ее профессия, национальность, партийность? Это же все для анкет, а не для жизни',
            is_rand: true
        },
        {
            img: 'img/show_me_your_code.jpg',
            text: 'Прокомментировать твою оборотно-сальдовую ведомость?',
            is_rand: true
        },
        {
            img: 'http://thecatapi.com/api/images/get?format=src&type=gif&size=med&6',
            text: 'Я всегда помню, где я была, когда и с кем.',
            is_rand: true
        },
        {
            img: 'img/kitty.gif',
            text: 'Бровь должна быть тоненькая-тоненькая, как ниточка. Удивленно приподнятая.',
            is_rand: true
        },
        {
            img: 'http://thecatapi.com/api/images/get?format=src&type=gif&size=med&8',
            text: '— Блайзер — клубный пиджак.<br>'
                + '— Для «Дома культуры», что ли?<br>'
                + '— Туда тоже можно.',
            is_rand: true
        }
	];

    for(var i = 0; i < data.length; i++) {
        if (data[i].win) {
            presents.push({
                img: 'win/' + data[i].win,
                text: data[i].text,
                is_rand: false
            });
        }
    }

	var maxAttempts = 5; //на который раз выпадут все одинаковые

	var animateRotateFunction = function($elem, angle) {
		$({
			deg: 0
		}).animate({
			deg: angle
		}, {
			duration: 1000,
			step: function (now) {
				$elem.css({
					transform: 'rotate(' + now + 'deg)'
				});
			}
		});
	}


	var getRandomFunction = function() {
		return Math.floor(Math.random() * (presents.length  + 1));
	}

	var final = getRandomFunction();

	$(presents).each(function(i, item) {
		$('.randomizeMachine').append('<div style="width:320px;height:320px;background-position:center;background:url(\'' + item['img'] + '\');background-position:center;background-size:contain;"></div>');
	});
	
	var randomizeFunction = function(activeElementIndex) {
		if (attempts == maxAttempts) {
			setTimeout(function() { animateRotateFunction($('.randomizeMachine'), 360); }, 2000);
			return final;
		}
		return getRandomFunction();
	}

    var messages = [];

    var onStop = function(cnt) {
        messages[messages.length] = cnt;

        if (messages.length > 2) {
            $('#greetingText').find('.js-txt-1').html(presents[messages[0]].text);
            $('#greetingText').find('.js-txt-2').html(presents[messages[1]].text);
            $('#greetingText').find('.js-txt-3').html(presents[messages[2]].text);
            $('#ranomizeButton').text('Попробовать еще раз');
        }
    }

	setTimeout(function() {

		var machine1 = $("#machine1").slotMachine({
			randomize: randomizeFunction,
			active: 0,
			delay: 500
		});

		var machine2 = $("#machine2").slotMachine({
			randomize: randomizeFunction,
			active: 1,
			delay: 500,
			direction: 'down'
		});

		var machine3 = $("#machine3").slotMachine({
			randomize: randomizeFunction,
			active: 2,
			delay: 500
		});

		$("#ranomizeButton").click(function(){

			attempts++;

            if (attempts > 2) {
                $('#hardcore').show();
            }

            messages = [];
            $('#greetingText').find('p').html('');

			machine1.shuffle(5, onStop);

			setTimeout(function(){
				machine2.shuffle(5, onStop);
			}, 500);

			setTimeout(function(){
				machine3.shuffle(5, onStop);
			}, 1000);

		});
	
		$('#randomize').css({opacity: 1});


	}, 1000);
});
</script>

<div id="hardcore" style="display:none;position: absolute;top:5%;right:5%;width:112px;height:184px"><a href="leo.html">Переключиться на режим безудержного веселья &rarr;<img src="img/hardmode.gif"></a></div>

</body>
</html>
